<!doctype html>

<head>
	<title> piano roll in the browser wow </title>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
	<script src='scripts/classes.js'></script>
	<script src='scripts/globals.js'></script>
	<!--
	<script src='build_grid.js'></script>
	<script src='dom_modification.js'></script>
	<script src='play_functionality.js'></script>
	-->
	<meta charset='utf-8'>
</head>

<style>
	html{
		font-family: Arial;
	}
	
	table, tr, td{
		border: 1px solid #000;
	}

	#piano{
		display: inline-block;
		/* this is important for letting the grid expand horizontally */
		white-space: nowrap;
	}
	
	#wavetypeLabel, #tempoLabel{
		font-family: 'arial', 'gothic ms';
		font-size: 14px;
		padding-left: 10px;
	}
	
	#changeTempo{
		width: 40px;
	}
	
	#title{
		margin: 0;
	}
	
	ul{
		padding: 0;
		margin: 0;
	}
	
	li{
		list-style-type: none;
		display: inline-block;
	}
	
	li h2{
		font-size: 12px;
	}
	
	.footer{
		text-align: center;
		margin-top: 3%;
		font-size: 12px;
		font-family: 'ms gothic';
		border-top: 1px solid #000;
	}
</style>

<body>

<h2 id='title'> piano roll fun ʕ•ᴥ•ʔ</h2>

<div id='toolbar'>

	<ul>
		<li><h2 id='measures'></h2></li>
		<li>|</li>
		<li><h2 id='timeSig'></h2></li>
		<li>|</li>
		<li><h2 id='subdiv'></h2></li>
		<li>|</li>
		<li><h2 id='tempo'>120 bpm</h2></li>
	</ul>

	<ul>
		<li><button onclick='play()'> play! </button></li>
		<li><button onclick='playAll()'> play <b>all</b>! </button></li>
		<li><button onclick='stopPlay()'> stop! </button></li>
		<li><button onclick='addNewMeasure()'> add new measure </button></li>
		<li><button onclick='addNewInstrument()'> add new instrument </button></li>
		<li><button onclick='clearGrid()'> clear grid </button></li>
		<li>
			<label id='wavetypeLabel'> wave type:
			<select id='selectWave'>
				<option> sine </option>
				<option> square </option>
				<option> sawtooth </option>
				<option> triangle </option>
			</select>
			</label>
		</li>
		<li>
			<label id='tempoLabel'> tempo: 
			<input id='changeTempo' type='text'></input>
			</label>
		</li>
		<li>
			<button onclick='changeTempo()'> change tempo </button>
		</li>
	</ul>

</div>

<br>
<br>

<div>
	<table>
		<tr id='instrumentTable'>
			<td id='1' selected='1' style='background-color: rgb(188,223,70)' onclick='chooseInstrument(this.id)'> default instrument </td>
		</tr>
	</table>
</div>

<br>

<div id='piano'>
	<div id='columnHeaderRow'></div>
</div>


<div class='footer'>
	<p> c.2017 nch works </p>
</div>

</body>

<script>

//references:
//http://jsfiddle.net/remotesynth/73cD5/?utm_source=website&utm_medium=embed&utm_campaign=73cD5
//https://modernweb.com/creating-sound-with-the-web-audio-api-and-oscillators/
//http://www.phy.mtu.edu/~suits/notefreqs.html
//http://stackoverflow.com/questions/1114024/constructors-in-javascript-objects
//http://stackoverflow.com/questions/32239560/web-audio-oscillators-unexpectedly-glide-from-one-frequency-to-another-in-chrome
//http://stackoverflow.com/questions/15261030/web-audio-start-and-stop-oscillator-then-start-it-again
//http://stackoverflow.com/questions/18785951/how-to-get-width-of-a-div-in-percentage-using-jquery
//http://alemangui.github.io/blog//2015/12/26/ramp-to-value.html
//http://stackoverflow.com/questions/4909167/how-to-add-a-custom-right-click-menu-to-a-webpage

// ooooh make it recordable!
// https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/createMediaStreamDestination

//TODO:
/*
-tempo change - currently ~152 bpm!
-allow color customizations for highlight, note blocks
-legato, staccato toggling for individual notes
-bend notes? :>
-multiple instruments => this is gonna be hard because we can't keep adding rows and columns to the DOM => reuse same grid, but store note info!
-onion-skin type thing to show where other instruments' notes are like in PxTone
*/

/**** INFORMATION ABOUT THE CURRENT SETUP ****/
var numberOfMeasures = 4; 	// 4 measures by default
var subdivision = 8; 		// each measure subdivided by eighth notes
var timeSignature = "4/4";
var currentTempo = 500; 	// hold the current tempo - in milliseconds!! default is 120 bpm

$('#measures').html("number of measures: " + numberOfMeasures);
$('#timeSig').html("time signature: " + timeSignature);
$('#subdiv').html("subdivision: " + subdivision);

/**** SET UP AUDIO CONTEXT *****/
var context = new AudioContext();

// SET UP INITIAL INSTRUMENT
// this oscillator is used to hear notes when they get clicked on the grid
var g = initGain();
var oscillator = initOscillator(g);	
g.connect(context.destination);		// hook up gain with audio context

// put initial instrument in instruments object
var initialInstrument = new Instrument("Instrument 1", oscillator, g, []);
instruments.push(initialInstrument);
currentInstrument = instruments[0];

// create a new gain object
function initGain(){
	var newGain = context.createGain();
	// set gain to 0 initially so no sound will be heard 
	newGain.gain.value = 0.0;
	return newGain;
}

// create a new oscillator
function initOscillator(gain){
	var o = context.createOscillator();
	o.type = $('#selectWave').val();
	o.connect(gain); 
	o.start(0);
	return o;
}

/************** CHANGE TEMPO ******************/
//http://www.sengpielaudio.com/calculator-bpmtempotime.htm

function changeTempo(){
	var tempoInput = document.getElementById("changeTempo");
	var selectedTempo = parseInt(tempoInput.value);
	var tempoText = document.getElementById("tempo")
	tempoText.innerHTML = selectedTempo + " bpm";
	
	// initially getting milliseconds FOR QUARTER NOTES
	// note that currentTempo needs to be rounded before use
	currentTempo = ((Math.round((60000/selectedTempo) * 1000)) / 1000 );
	
	// go through all instruments and adjust duration of each note in their note arrays
	// according to new current tempo
	for(var i = 0; i < instruments.length; i++){
		if(instruments[i] != currentInstrument){
			var noteArray = instruments[i].notes;
			for(var j = 0; j < noteArray.length; j++){
				if(noteArray[j].duration > 1){
					// NEED TO CHECK TYPE OF NOTE TO ASSIGN CORRECT DURATION!
					 noteArray[j].duration = getCorrectLength(noteArray[j].block, currentTempo)
				}
			}
		}
	}
}

/************** DOM MODIFICATION *******************/

// allows for a note to sound temporarily when user clicks on a block 
function clickNote(id, waveType){
	var parent = document.getElementById(id).parentNode.id;
	parent = parent.replace('s', '#'); // replace any 's' with '#' so we can match a key in noteFrequencies
	
	setTimeout(function(){
		oscillator.type = waveType;
		oscillator.frequency.setValueAtTime(noteFrequencies[parent], 0);
		g.gain.value = .3;
		// this setTimeout makes sure the oscillator gets silent again
		setTimeout(function(){
			oscillator.frequency.value = 0.0;
			g.gain.value = 0;
		}, 100);
	}, 10); // use a small value like 10 so it starts "immediately"
}

// make blocks on grid clickable 
function addNote(id, type){
	if($('#' + id).css("background-color") === "rgb(0, 178, 0)"){
		$('#' + id).css("background-color", "transparent");
		
		// change hasNote attribute to false (0) in column header
		var headerId = id.substring(id.indexOf("col"));
		var currValue = parseInt(document.getElementById(headerId).getAttribute("hasNote"));
		document.getElementById(headerId).setAttribute("hasNote", --currValue);
		
		// if you choose a same note for the current instrument as another instrument, that will wipe out the 
		// 'onion-skin' of the other instrument's note. but if you delete that note for
		// the current instrument later, calling showOnionSkin() here will put back the 'onion-skin' for
		// the other instrument. there is no static 'onion-skin' layer. it's just changing the background-color 
		// of note blocks
		showOnionSkin(); 
		
	}else{
		$('#' + id).css("background-color", "#00B200");
		
		//change hasNote attribute to true (1) in column header
		var headerId = id.substring(id.indexOf("col"));
		var currValue = parseInt(document.getElementById(headerId).getAttribute("hasNote"));
		document.getElementById(headerId).setAttribute("hasNote", ++currValue);
	}
	var waveType = $('#' + type);
	clickNote(id, waveType.val());
}

// make a row highlightable on mouse over - easier to see what note a block is
function highlightRow(id, color){
	// get id of parent
	var parent = document.getElementById(id).parentNode.id;
	// highlight
	$('#' + parent).css('background-color', color);
}

// delete all notes
function clearGrid(){
	var columns = document.getElementById("columnHeaderRow").children;
	// start at 1 to ignore the column before 1 (the blank one)
	for(var i = 1; i < columns.length; i++){
		if(columns[i].getAttribute("hasnote") !== "0"){
			// change hasnote attribute back to 0!
			columns[i].setAttribute("hasnote", "0");
			var columnToCheck = $("div[id$='col_" + (i-1) + "']").get();
			for(var j = 0; j < columnToCheck.length; j++){
				if(columnToCheck[j].style.backgroundColor === "rgb(0, 178, 0)"){
					columnToCheck[j].style.backgroundColor = "transparent";
				}
			}
		}
	}
}

// add a new measure 
function addNewMeasure(){

	$('#measures').text( "number of measures: " + (parseInt($('#measures').text().trim().split(' ').reverse()[0]) + 1) );
	
	// find the dummy node for the header columns and insert before that node
	// the new subdivisions of the new measure
	var dummy = $("div[id='columnHeaderRow_dummy']").get()[0];
	var dummyParent = dummy.parentNode;
	
	// new column headers 
	for(var i = 0; i < subdivision; i++){
		var newHeader = document.createElement('div');
		newHeader.id = "col_" + (numberOfMeasures * subdivision + i); 
		newHeader.style.width = '40px';
		newHeader.style.height = '12px';
		newHeader.style.fontSize = '10px';
		newHeader.style.display = 'inline-block';
		newHeader.style.textAlign = "center";
		
		// 0 == false; i.e. does not have a note in the column
		// this attribute should help optimize performance a bit
		newHeader.setAttribute("hasNote", 0); 
		
		newHeader.textContent =  i + 1;
		
		if(i + 1 === subdivision){
			newHeader.style.borderRight = "3px solid #000";
		}else{
			newHeader.style.borderRight = "1px solid #000";
		}
		dummyParent.insertBefore(newHeader, dummy);
	}
	
	// now add new columns for each note
	var noteRows = $('#piano').children().get();
	
	// start at 1 to skip column header row 
	for(var j = 1; j < noteRows.length; j++){
		for(var k = 0; k < subdivision; k++){
			// get the dummy element for this row
			dummy = $("div[id='" + noteRows[j].id + '_dummy' + "']").get()[0];
			var newColumn = document.createElement("div");
			newColumn.id = noteRows[j].id + "col_" + ((numberOfMeasures * subdivision) + k);
			// adjust id if needed
			newColumn.id = replaceSharp(newColumn.id);
			newColumn.style.display = 'inline-block';
			newColumn.style.width = '40px';
			newColumn.style.height = '15px';
			
			// IMPORTANT! new attributes for each note
			newColumn.setAttribute("volume", "");
			newColumn.setAttribute("length", "eighth"); // length of note (quarter, eighth?)
			newColumn.setAttribute("type", ""); // type of note - staccato, legato? 
			
			if((k + 1) % subdivision == 0){
				newColumn.style.borderRight = "3px solid #000";
			}else{
				newColumn.style.borderRight = "1px solid #000";
			}

			// hook up an event listener to allow for selecting notes on the grid!
			//notice passing in id of option/select element for picking wave type. 
			newColumn.addEventListener("click", function(){ addNote(this.id, "selectWave") }); 
			// allow for highlighting to make it clear which note a block is
			newColumn.addEventListener("mouseenter", function(){ highlightRow(this.id, '#FFFF99') });
			newColumn.addEventListener("mouseleave", function(){ highlightRow(this.id, 'transparent') });
			noteRows[j].insertBefore(newColumn, dummy);
		}
		// adjust width of row 
		noteRows[j].style.width = parseInt(noteRows[j].style.width) + 20 + "%";
	}
	numberOfMeasures++; // increment measure variable
}

// choose an instrument 
function chooseInstrument(thisElement){
	// console.log(thisElement);
	// look at grid, collect the notes, save them to the current instrument, and
	// move on to the clicked-on instrument
	currentInstrument.notes = readInNotes();
	
	var instrumentsView = document.getElementById('instrumentTable').children;

	// change other instruments' label background color to transparent
	for(var i = 0; i < instrumentsView.length; i++){
		if(instrumentsView[i]){
			instrumentsView[i].style.backgroundColor = "transparent";
		}
	}
	
	// get index of clicked-on instrument in instrumentTable and subtract 1 to
	// account for 0-index when we use it to look in the global variable 'instruments' 
	// array for the corresponding instrument object
	var index = parseInt(thisElement) - 1;
	clearGrid();
	currentInstrument = instruments[index]; // this is the new instrument
	
	// then draw the previously-saved notes, if any, onto the grid of the clicked-on instrument
	drawNotes(currentInstrument); 
	
	$('#' + thisElement).css('background-color', 'rgb(188,223,70)');
	
	showOnionSkin();
}

// draw notes back on to grid
// takes an instrument object and uses its notes array data to draw back the notes
function drawNotes(instrumentObject){
	var notes = instrumentObject.notes;
	for(var i = 0; i < notes.length; i++){
		var duration = notes[i].duration;
		if(notes[i].block){
			// make sure the column header also sets "hasnote" to 1!
			var headerID = notes[i].block.id.substring(notes[i].block.id.indexOf("col_"));
			var header = document.getElementById(headerID);
			header.setAttribute("hasnote", "1");

			(notes[i].block).style.backgroundColor = "rgb(0, 178, 0)";
		}
	}
}

/***** PRODUCE THE GRID HEADER ********/
// dynamically produce piano roll 
var thePiano = $('#piano');
var columnHeaderRow = $('#columnHeaderRow');

// this will provide the headers for each column in the grid (i.e. number for each beat/subbeat) 
for(var i = 0; i < numberOfMeasures * subdivision + 1; i++){
	var columnHeader = document.createElement('div');
	columnHeader.id = "col_" + (i - 1); // the - 1 here is important! 
	columnHeader.style.display = "inline-block";
	
	if(i > 0){
		columnHeader.style.borderRight = "1px solid #000";
		columnHeader.style.textAlign = "center";
		
		if(i < subdivision + 1){
			if(i === subdivision){
				columnHeader.style.borderRight = '3px solid #000';
			}
			columnHeader.textContent = i;
		}else if(i !== numberOfMeasures * subdivision + 1){
			// subdiv goes from 1 to 16. if more than 16, start at 1 again. 
			var subdiv = (i % subdivision) === 0 ? subdivision : (i % subdivision);
			if(subdivision === subdiv){
				columnHeader.style.borderRight = '3px solid #000';
			}
			columnHeader.textContent = subdiv; 
		}
	}
	
	if(i === 0){
		columnHeader.style.width = '50px';
		columnHeader.style.height = '12px';
		columnHeader.style.border = '1px solid #000';
	}else{
		columnHeader.style.width = '40px';
		columnHeader.style.height = '12px';
		columnHeader.style.fontSize = '10px';
	}
	
	// 0 == false; i.e. does not have a note in the column
	columnHeader.setAttribute("hasNote", 0); 
	
	columnHeaderRow.append(columnHeader);
}
// can't pass in a jquery selected element
appendDummyElement(document.getElementById('columnHeaderRow'));

/******* BUILDING THE GRID ********/
var note;
for(note in noteFrequencies){
	
	note = note;
	
    // ignore enharmonics 
    if(note.substring(0, 2) === "Gb" || note.substring(0, 2) === "Db" ||
	   note.substring(0, 2) === "D#" || note.substring(0, 2) === "G#" ||
	   note.substring(0, 2) === "A#"){
		continue;
	}
	
	//first create new element for new pitch
	var newRow = document.createElement('div');
	newRow.id = replaceSharp(note);
	
	var newRowText = document.createElement('div');
	newRowText.innerHTML = note.substring(0, note.length - 1) + "<sub>" + note[note.length-1] + "</sub>";
	newRowText.style.fontSize = '11px';
	newRowText.style.border = "1px solid #000";
	newRowText.style.display = 'inline-block';
	newRowText.style.width = "50px";
	newRowText.style.verticalAlign = "middle";
	
	newRow.appendChild(newRowText);
	thePiano.append(newRow);
	/* append columns to each row */
	for(var j = 0; j < numberOfMeasures * subdivision; j++){
		var column = document.createElement("div");
		column.id = replaceSharp(note) + "col_" + j;
		column.style.display = 'inline-block';
		//column.style.cssFloat = "left";
		column.style.width = "40px";
		column.style.height = "15px";
		column.style.verticalAlign = "middle";
	
		// IMPORTANT! new attributes for each note
		column.setAttribute("volume", "");
		column.setAttribute("length", "eighth"); // length of note (quarter, eighth?)
		column.setAttribute("type", ""); // type of note - staccato, legato? 
		
		if((j + 1) % subdivision == 0){
			column.style.borderRight = "3px solid #000";
		}else{
			column.style.borderRight = "1px solid #000";
		}

		// hook up an event listener to allow for picking notes on the grid!
		column.addEventListener("click", function(){ addNote(this.id, "selectWave") });
		// allow for highlighting to make it clear which note a block is
		column.addEventListener("mouseenter", function(){ highlightRow(this.id, '#FFFF99') });
		column.addEventListener("mouseleave", function(){ highlightRow(this.id, 'transparent') });
		newRow.appendChild(column);
	}
	//
	//this was used previously to clear the float lefts when I floated all the grid blocks left.
	//but since they're all now display: inline-block instead, which works much better, this is
	//really an artifact now. 
	appendDummyElement(newRow);
}

// helper function to replace '#' in string 
function replaceSharp(string){
	// this adjustment is only necessary for labeling the DOM elements so that they're clickable
	// previously, without this adjustment, sometimes you'd get a string id with two '#' chars for the sharp notes,
	// because of how I decided to label my ids. since you also need a # for jQuery selection, adjustment is necessary. 
	if(string.indexOf('#') != -1){
		return string.replace('#', 's'); // s for sharp
	}
	// otherwise do nothing
	return string;
}

// onion-skin!!
// see where the other instruments' notes are 
function showOnionSkin(){
	for(var i = 0; i < instruments.length; i++){
		if(instruments[i] !== currentInstrument){
			// go through each instrument's notes
			for(var j = 0; j < instruments[i].notes.length; j++){
				// get location of each note
				var location = instruments[i].notes[j].block; 
				if(instruments[i].notes[j].freq > 1){
					// set background color for that location a very light shade of green
					location.style.backgroundColor = "rgba(0, 178, 0, 0.1)";
				}
			}
		}
	}
}

function appendDummyElement(elementToAppendTo){
	var dummyElement = document.createElement('div');
	dummyElement.id = elementToAppendTo.id + "_dummy";
	elementToAppendTo.appendChild(dummyElement);
}

/******* GET NOTES AND PLAY ******/

function getCorrectLength(noteObjectBlock, currentTempo){
	if(noteObjectBlock){
		if(noteObjectBlock.getAttribute("length") === "quarter"){
			return Math.round(currentTempo);
		}else if(noteObjectBlock.getAttribute("length") === "eighth"){
			return Math.round(currentTempo / noteLengths["eighth"]);
		}
	}else{
		return Math.round(currentTempo / noteLengths["eighth"]);
	}
}

/* this will read all the notes, put them in an array and returns the array */
function readInNotes(){
	var notes = []; // don't worry about what was in notes previously. 
	
	// first find what the last column with a note (hasnote === 1) is 
	// this will aid performance and prevent unnecessary column look-throughs 
	var columnHeaders = document.getElementById("columnHeaderRow").children;
	var lastColumn = -1;
	for(var k = 0; k < columnHeaders.length; k++){
		if(columnHeaders[k].getAttribute('hasnote') === '1'){
			lastColumn = parseInt(columnHeaders[k].id.substring(4));
		}
	}
	// gather each column
	for(var i = 0; i <= lastColumn; i++){
		
		var column = $("div[id$='col_" + i + "']").get(); //get all the blocks in each column
		var found = 0;
		// go down each column and look for green. if found, stop and add to array. then move on.
		for(var j = 0; j < column.length; j++){
			// look for green background! 
			if(column[j].style.backgroundColor === "rgb(0, 178, 0)"){
				found = 1;
				// make any corrections to id string before matching with freq key
				var freq = noteFrequencies[ (column[j].parentNode.id).replace('s', '#') ];
				
				notes.push(new Note(freq, getCorrectLength(column[j], currentTempo), column[j]));
		
				break;
			}
		}
		if(found === 0){
			// don't pass in div block location for rests (notes with no pitches)
			// since by default the measures are subdivided by eighth notes, rests will automatically be eighth rests 
			notes.push(new Note(0.0,  Math.round(currentTempo / noteLengths["eighth"]), null));
		}
	}
	return notes;
}

/* 
this function takes an array of notes, an index, and an oscillator and plays the note at that index 
with a specific duration with the passed-in oscillator.
*/
function readAndPlayNote(array, index, oscillatorNode, gainNode){  
	// when to stop playing 
	if(index === array.length){
		gainNode.gain.value = 0;
	}else{
		oscillatorNode.type = $('#selectWave').val();
		// oscillator.frequency.value = array[index].getFrequency();
		/* tip! by setting value at a certain time, this prevents the 'gliding' from one freq. to the next */
		oscillatorNode.frequency.setValueAtTime(array[index].getFrequency(), 0);
		// by setting gain value here according to the two conditions, this allows for the 'articulation' of notes without 
		// the 'helicopter' sound when a certain note frequency is 0. 
		// previously, the gain would have been .3 even for notes with 0 frequency,
		// which causes some increase in volume in background sound.
		// it was only detectable when I added the setTimeout below where I set gain to 0.
		// this is fixed by always setting gain to 0 if a note's frequency is 0.
		gainNode.gain.value = array[index].getFrequency() > 0 ? .3 : 0.0;
		if(index < array.length){
			// hold the current note for whatever duration was specified
			// in other words, hold this current note for array[index].getDuration(), then move on to the next note.
			// note that index is pre-incremented for the next note, but we also need the duration for this current index!
			// therefore, currIndex will hold the current note's index.
			var currIndex = index;
			
			// change gain to 0 after a really small amount of time to give the impression of articulation
			// 100 might have to be a better value later to coordinate with when the next note will play
			setTimeout(function(){ gainNode.gain.value = 0.0; }, 100); 
			
			// create a new timer and push to timers array 
			timer = setTimeout(function(){readAndPlayNote(array, ++index, oscillatorNode, gainNode)}, array[currIndex].getDuration()); 
		}
	}
}

// stop playback 
function stopPlay(){
	clearTimeout(timer);
	for(var i = 0; i < instruments.length; i++){
		instruments[i].gain.gain.value = 0.0;
	}
}

// play notes for current instrument
function play(){
	readAndPlayNote(readInNotes(), 0, currentInstrument.oscillator, currentInstrument.gain);
}

// play all instruments 
function playAll(){
	currentInstrument.notes = readInNotes();
	for(var i = 0; i < instruments.length; i++){
		readAndPlayNote(instruments[i].notes, 0, instruments[i].oscillator, instruments[i].gain);
	}
}

/**********  ADD A NEW INSTRUMENT FUNCTIONS ************/
function addNewInstrument(){
	var instrumentTable = document.getElementById("instrumentTable");
	var newInstrument = document.createElement('td');
	
	// we want to be able to access the instruments in sequential order
	newInstrument.id = "" + (instruments.length + 1); 
	newInstrument.setAttribute("selected", "0");
	newInstrument.style.backgroundColor = "transparent";
	
	newInstrument.innerHTML = "new_instrument";
	newInstrument.addEventListener('click', function(event){
		// pass the event target's id to chooseInstrument()
		chooseInstrument(event.target.id);
	});
	
	instrumentTable.appendChild(newInstrument);
	
	createNewInstrument("blah");
}

function createNewInstrument(name){
	// make new oscillator and gain nodes
	var newGain = initGain();
	var newOscillator = initOscillator(newGain);
	newGain.connect(context.destination);
	
	// create new instrument with oscillator
	var newInstrument = new Instrument("blah", newOscillator, newGain, []);
	instruments.push(newInstrument);
}

function deleteInstrument(){
}


</script>


</html>
